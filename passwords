#!/bin/bash

# Get the current user
CURRENT_USER=$(whoami)

# Define password policy configurations
MIN_LEN=12  # Minimum password length
MIN_DAYS=1  # Minimum number of days between password changes
MAX_DAYS=90  # Maximum password validity (90 days)
WARN_DAYS=7  # Days before expiry to warn users

# Update the /etc/login.defs for system-wide policy
echo "Setting password policy in /etc/login.defs..."
sudo sed -i "s/^PASS_MIN_LEN.*/PASS_MIN_LEN   $MIN_LEN/" /etc/login.defs
sudo sed -i "s/^PASS_MAX_DAYS.*/PASS_MAX_DAYS   $MAX_DAYS/" /etc/login.defs
sudo sed -i "s/^PASS_MIN_DAYS.*/PASS_MIN_DAYS   $MIN_DAYS/" /etc/login.defs
sudo sed -i "s/^PASS_WARN_AGE.*/PASS_WARN_AGE   $WARN_DAYS/" /etc/login.defs

# Apply password policy to all users, excluding the current user
echo "Applying password policy to users, excluding $CURRENT_USER..."
for user in $(cut -d: -f1 /etc/passwd); do
    if [ "$user" != "$CURRENT_USER" ]; then
        sudo chage --mindays $MIN_DAYS --maxdays $MAX_DAYS --warndays $WARN_DAYS $user
    fi
done

# Inform the user about the applied policies
echo "Password policies applied successfully."
echo "Minimum password length: $MIN_LEN"
echo "Password must be changed every $MAX_DAYS days."
echo "Users will be warned $WARN_DAYS days before password expiry."
